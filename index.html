<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ú–∞—Å–ª–µ–Ω–∏—Ü–∞: —Å–æ–∂–≥–∏ —á—É—á–µ–ª–æ</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            margin: 0;
            padding: 0;
        }
        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(145deg, #ff944d, #f76300);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }
        .game-card {
            max-width: 480px;
            width: 100%;
            background: #fff1d4;
            border-radius: 40px 40px 35px 35px;
            border: 4px solid #ffb457;
            box-shadow: 0 15px 20px #8a3d19;
            padding: 14px 10px 18px;
        }
        .title {
            font-size: 2rem;
            font-weight: 900;
            color: #4e260b;
            text-shadow: 2px 2px 0 #ffb95e;
            text-align: center;
            margin: 0 0 6px;
        }
        .pancakes-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: #c96829;
            padding: 8px 18px;
            border-radius: 40px;
            border: 3px solid #ffd58c;
            margin: 0 auto 10px;
            width: fit-content;
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffefc0;
            box-shadow: inset 0 -2px 0 #884e1e;
        }
        .lives-block {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #673e1d;
            padding: 6px 18px;
            border-radius: 40px;
            border: 3px solid #feb65e;
            width: fit-content;
            margin: 0 auto 12px;
        }
        .heart {
            font-size: 2rem;
            transition: 0.2s;
            filter: drop-shadow(0 2px 2px #221002);
        }
        .heart.lost {
            opacity: 0.25;
            filter: grayscale(1);
        }
        .area {
            background: #b15927;
            background: radial-gradient(circle at 20% 30%, #d67f3a, #a04215);
            border-radius: 80px 80px 40px 40px;
            padding: 18px 12px 16px;
            border: 4px solid #ffb457;
            box-shadow: inset 0 -5px 0 #7b3f18, 0 10px 15px #7a3e1a;
            margin: 5px 0 12px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: nowrap;
        }
        .image-box {
            position: relative;
            width: 140px;
            height: 140px;
            flex-shrink: 0;
        }
        .scarecrow {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 30px;
            border: 4px solid #ffb860;
            background: #a0521d;
            box-shadow: 4px 5px 0 #4f2a0f;
            transition: filter 0.3s;
        }
        .burnt {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000000e5;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff8f5a;
            font-size: 1.4rem;
            font-weight: 900;
            backdrop-filter: grayscale(1);
            opacity: 0;
            transition: opacity 0.4s;
            pointer-events: none;
            border: 3px solid #ff7300;
        }
        .burnt.show { opacity: 1; }
        
        .v-progress {
            width: 30px;
            height: 140px;
            background: #3e1c09;
            border-radius: 30px;
            border: 3px solid #ffb457;
            box-shadow: inset 0 0 0 2px #241004;
            padding: 4px;
            display: flex;
            flex-direction: column-reverse;
        }
        .v-fill {
            width: 100%;
            height: 0%;
            background: linear-gradient(0deg, #ff5e00, #ffb347);
            border-radius: 25px;
            transition: height 0.15s;
            border: 1px solid #ffffb0;
        }
        .fire-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 20;
        }
        .flame {
            position: absolute;
            font-size: 1.4rem;
            filter: drop-shadow(0 0 4px #ff9900);
            animation: flicker 0.8s infinite alternate;
        }
        @keyframes flicker {
            0% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(1.2); opacity: 1; }
        }
        .action-btn {
            background: #f5832b;
            border: none;
            width: 100%;
            padding: 16px 10px;
            border-radius: 80px;
            font-size: 2rem;
            font-weight: 900;
            color: #fff3cd;
            text-transform: uppercase;
            border-bottom: 6px solid #964b1e;
            text-shadow: 2px 2px 0 #773d12;
            cursor: pointer;
            transition: 0.08s;
            box-shadow: 0 10px 12px #6a3113;
            margin: 8px 0;
            touch-action: manipulation;
        }
        .action-btn:active {
            transform: translateY(4px);
            border-bottom-width: 3px;
        }
        .action-btn:disabled {
            opacity: 0.5;
            transform: translateY(3px);
            pointer-events: none;
        }
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—É—á–µ–Ω–∏—è */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }
        .modal-content {
            max-width: 350px;
            width: 100%;
            background: #fff0d0;
            border-radius: 40px;
            border: 5px solid #ffa53e;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 15px 20px #6b2c0b;
        }
        .modal-content h2 {
            font-size: 1.8rem;
            margin: 0 0 10px;
            color: #552606;
        }
        .rules {
            background: #fec185;
            border-radius: 30px;
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: left;
        }
        .rules p {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            font-weight: 600;
        }
        .rules span { font-size: 1.5rem; }
        
        .modal-btn {
            background: #ff9f4b;
            border: none;
            font-size: 1.5rem;
            font-weight: 900;
            padding: 12px 25px;
            border-radius: 50px;
            color: #3b1a05;
            border-bottom: 5px solid #964b1e;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
        }
        .modal-btn:active {
            transform: translateY(3px);
            border-bottom-width: 3px;
        }
        .hidden { display: none; }
        
        .result-line {
            font-size: 1.2rem;
            margin: 10px 0;
            background: #ffeac2;
            padding: 12px;
            border-radius: 30px;
            text-align: left;
            line-height: 1.6;
        }
        .final-pancakes {
            background: #c96d2a;
            color: #fff8cf;
            padding: 15px;
            border-radius: 40px;
            font-size: 2rem;
            font-weight: 900;
            margin: 10px 0;
        }
        .footer-hint {
            text-align: center;
            font-size: 1rem;
            margin-top: 8px;
            color: #4a2810;
            font-weight: 600;
        }
    </style>
</head>
<body>
<div class="game-card">
    <div class="title">‚òÄÔ∏è –ú–ê–°–õ–ï–ù–ò–¶–ê ‚òÄÔ∏è</div>

    <!-- –°—á—ë—Ç—á–∏–∫ –±–ª–∏–Ω–æ–≤ -->
    <div class="pancakes-top">
        <span>ü•û</span>
        <span id="pancakeCounter">0</span>
    </div>

    <div class="lives-block" id="livesDisplay">
        <span class="heart">‚ù§Ô∏è</span>
        <span class="heart">‚ù§Ô∏è</span>
        <span class="heart">‚ù§Ô∏è</span>
    </div>

    <div class="area">
        <div class="image-box" id="scarecrowZone">
            <img src="https://markbartolomeev-blip.github.io/Maslenitsa/IMG_1194.png" alt="–ß—É—á–µ–ª–æ" class="scarecrow" id="scarecrowImg" crossorigin="anonymous">
            <div class="burnt" id="burntOverlay">–ü–ï–ü–ï–õ</div>
            <div class="fire-layer" id="fireLayer"></div>
        </div>
        <div class="v-progress">
            <div class="v-fill" id="progressFill"></div>
        </div>
    </div>

    <button class="action-btn" id="holdBtn">üî• –ñ–ï–ß–¨ üî•</button>
    <div class="footer-hint" id="statusMessage"></div>
</div>

<!-- –ú–ê–õ–ï–ù–¨–ö–û–ï –û–ë–£–ß–ï–ù–ò–ï -->
<div class="modal" id="tutorialModal">
    <div class="modal-content">
        <h2>ü•û –ü–†–ê–í–ò–õ–ê</h2>
        <div class="rules">
            <p><span>‚ù§Ô∏è</span> 3 –∂–∏–∑–Ω–∏</p>
            <p><span>üî•</span> –î–µ—Ä–∂–∏ –∫–Ω–æ–ø–∫—É ‚Äî –∂–≥–∏</p>
            <p><span>üò±</span> –û—Ç–ø—É—Å—Ç–∏–ª = ‚àí1 –∂–∏–∑–Ω—å</p>
            <p><span>ü•û</span> –ó–∞ –ø–æ–±–µ–¥—É –¥–∞–¥—É—Ç –±–ª–∏–Ω—ã</p>
        </div>
        <button class="modal-btn" id="closeTutorialBtn">–û–ö</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
<div class="modal hidden" id="resultModal">
    <div class="modal-content">
        <h2>üèÅ –†–ï–ó–£–õ–¨–¢–ê–¢</h2>
        <div id="statsMessage" class="result-line"></div>
        <div id="pancakeResult" class="final-pancakes"></div>
    </div>
</div>

<script>
(function() {
    // ===== —Å–ª—É—á–∞–π–Ω–æ–µ —Ü–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è =====
    const MIN_TARGET = 102 * 1000;   // 1.7 –º–∏–Ω
    const MAX_TARGET = 150 * 1000;   // 2.5 –º–∏–Ω
    
    const TARGET_MS = Math.floor(Math.random() * (MAX_TARGET - MIN_TARGET + 1)) + MIN_TARGET;
    const TARGET_MINUTES = (TARGET_MS / 60000).toFixed(1);
    
    // —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const MAX_LIVES = 3;
    let holding = false;
    let holdMs = 0;
    let lives = MAX_LIVES;
    let gameActive = true;
    let victory = false;
    let gameEnded = false;
    
    let animFrame = null;
    let lastTs = null;
    
    // DOM
    const holdBtn = document.getElementById('holdBtn');
    const progressFill = document.getElementById('progressFill');
    const fireLayer = document.getElementById('fireLayer');
    const scarecrow = document.getElementById('scarecrowImg');
    const burntOverlay = document.getElementById('burntOverlay');
    const statusMsg = document.getElementById('statusMessage');
    const livesContainer = document.getElementById('livesDisplay');
    const pancakeSpan = document.getElementById('pancakeCounter');
    
    const tutorialModal = document.getElementById('tutorialModal');
    const resultModal = document.getElementById('resultModal');
    const closeTutorialBtn = document.getElementById('closeTutorialBtn');
    const statsMessage = document.getElementById('statsMessage');
    const pancakeResult = document.getElementById('pancakeResult');
    
    // ===== —Ñ—É–Ω–∫—Ü–∏–∏ =====
    function updateLivesUI() {
        const hearts = livesContainer.querySelectorAll('.heart');
        hearts.forEach((heart, idx) => {
            if (idx < lives) heart.classList.remove('lost');
            else heart.classList.add('lost');
        });
    }
    
    // –ù–ê–ß–ò–°–õ–ï–ù–ò–ï –ó–ê –í–†–ï–ú–Ø
    function getTimePancakes(minutes) {
        if (minutes >= 1.7 && minutes <= 1.9) return 1;
        if (minutes >= 2.0 && minutes <= 2.1) return 2;
        if (minutes >= 2.2 && minutes <= 2.3) return 3;
        if (minutes >= 2.4 && minutes <= 2.5) return 5;
        return 0;
    }
    
    // –ù–ê–ß–ò–°–õ–ï–ù–ò–ï –ó–ê –ñ–ò–ó–ù–ò (–ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê)
    function getLivesPancakes(livesLeft) {
        if (livesLeft === 3) return 10;  // –æ—Å—Ç–∞–ª–æ—Å—å 3 –∂–∏–∑–Ω–∏
        if (livesLeft === 2) return 5;   // –æ—Å—Ç–∞–ª–æ—Å—å 2 –∂–∏–∑–Ω–∏
        if (livesLeft === 1) return 3;   // –æ—Å—Ç–∞–ª–∞—Å—å 1 –∂–∏–∑–Ω—å
        return 0;                         // 0 –∂–∏–∑–Ω–µ–π (–ø–æ—Ä–∞–∂–µ–Ω–∏–µ)
    }
    
    function refreshVisuals() {
        if (victory) {
            progressFill.style.height = '100%';
            burntOverlay.classList.add('show');
            scarecrow.style.filter = 'grayscale(1) brightness(0.3)';
            fireLayer.innerHTML = '';
            holdBtn.disabled = true;
            statusMsg.innerText = '‚ú® –ü–æ–±–µ–¥–∞! ‚ú®';
            if (!gameEnded) {
                gameEnded = true;
                showResult(true);
            }
            return;
        }
        
        if (lives <= 0) {
            progressFill.style.height = '0%';
            burntOverlay.classList.remove('show');
            scarecrow.style.filter = 'none';
            fireLayer.innerHTML = '';
            holdBtn.disabled = true;
            statusMsg.innerText = 'üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ üíî';
            if (!gameEnded) {
                gameEnded = true;
                showResult(false);
            }
            return;
        }
        
        const percent = (holdMs / TARGET_MS) * 100;
        progressFill.style.height = percent + '%';
        
        if (holding && !victory && lives > 0) {
            const flameCount = Math.floor(percent / 10) + 1;
            fireLayer.innerHTML = '';
            for (let i = 0; i < flameCount; i++) {
                const f = document.createElement('span');
                f.className = 'flame';
                f.textContent = 'üî•';
                f.style.left = Math.random() * 90 + '%';
                f.style.top = Math.random() * 90 + '%';
                f.style.fontSize = (1.2 + Math.random() * 1.2) + 'rem';
                fireLayer.appendChild(f);
            }
        } else {
            fireLayer.innerHTML = '';
        }
        
        burntOverlay.classList.remove('show');
        scarecrow.style.filter = 'none';
    }
    
    function checkVictory() {
        if (holdMs >= TARGET_MS && !victory) {
            victory = true;
            gameActive = false;
            holding = false;
            if (animFrame) cancelAnimationFrame(animFrame);
            animFrame = null;
            refreshVisuals();
        }
    }
    
    function loseLife() {
        if (victory || lives <= 0) return;
        lives -= 1;
        updateLivesUI();
        holdMs = 0;
        refreshVisuals();
        
        if (lives <= 0) {
            gameActive = false;
            holding = false;
            if (animFrame) cancelAnimationFrame(animFrame);
            animFrame = null;
            holdBtn.disabled = true;
        }
    }
    
    function showResult(isWin) {
        console.log('–ü–æ–±–µ–¥–∞?', isWin);
        
        if (isWin) {
            // –ü–û–ë–ï–î–ê - —Å—á–∏—Ç–∞–µ–º –±–ª–∏–Ω—ã
            const minutes = TARGET_MS / 60000;
            console.log('–ú–∏–Ω—É—Ç:', minutes);
            console.log('–û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π:', lives);
            
            const timeBonus = getTimePancakes(minutes);
            const livesBonus = getLivesPancakes(lives); // lives = 3,2 –∏–ª–∏ 1
            const total = timeBonus + livesBonus;
            
            console.log('–ë–æ–Ω—É—Å –∑–∞ –≤—Ä–µ–º—è:', timeBonus);
            console.log('–ë–æ–Ω—É—Å –∑–∞ –∂–∏–∑–Ω–∏:', livesBonus);
            console.log('–í—Å–µ–≥–æ –±–ª–∏–Ω–æ–≤:', total);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
            pancakeSpan.textContent = total;
            
            statsMessage.innerHTML = 
                `‚è±Ô∏è –í—Ä–µ–º—è: ${minutes.toFixed(1)} –º–∏–Ω ( +${timeBonus}ü•û )<br>` +
                `‚ù§Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${lives} ( +${livesBonus}ü•û )`;
            
            pancakeResult.innerHTML = `ü•û –ò–¢–û–ì–û: ${total} ü•û`;
        } else {
            // –ü–û–†–ê–ñ–ï–ù–ò–ï
            pancakeSpan.textContent = '0';
            
            statsMessage.innerHTML = 
                `üíî –ß—É—á–µ–ª–æ –Ω–µ —Å–≥–æ—Ä–µ–ª–æ<br>` +
                `ü•û –ë–ª–∏–Ω—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è`;
            
            pancakeResult.innerHTML = `ü•û –ò–¢–û–ì–û: 0 ü•û`;
        }
        
        // –ü–û–ö–ê–ó–´–í–ê–ï–ú –û–ö–ù–û
        resultModal.classList.remove('hidden');
    }
    
    // —Ü–∏–∫–ª —É–¥–µ—Ä–∂–∞–Ω–∏—è
    function holdCycle(now) {
        if (!holding || !gameActive || victory || lives <= 0) {
            if (animFrame) { cancelAnimationFrame(animFrame); animFrame = null; }
            return;
        }
        
        if (lastTs === null) {
            lastTs = now;
            animFrame = requestAnimationFrame(holdCycle);
            return;
        }
        
        const delta = Math.min(200, now - lastTs);
        if (delta > 0) {
            holdMs += delta;
            if (holdMs > TARGET_MS) holdMs = TARGET_MS;
            refreshVisuals();
            checkVictory();
        }
        
        lastTs = now;
        animFrame = requestAnimationFrame(holdCycle);
    }
    
    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    function onPress(e) {
        e.preventDefault();
        if (!gameActive || victory || lives <= 0 || gameEnded) return;
        if (holding) return;
        
        holding = true;
        lastTs = null;
        if (animFrame) cancelAnimationFrame(animFrame);
        animFrame = requestAnimationFrame(holdCycle);
        statusMsg.innerText = 'üî• –î–µ—Ä–∂–∏!';
    }
    
    function onRelease(e) {
        e.preventDefault();
        if (!gameActive || victory || lives <= 0 || gameEnded) {
            holding = false;
            return;
        }
        if (!holding) return;
        
        holding = false;
        if (animFrame) { cancelAnimationFrame(animFrame); animFrame = null; }
        lastTs = null;
        
        loseLife();
        refreshVisuals();
        if (lives > 0) statusMsg.innerText = `–ñ–∏–∑–Ω–µ–π: ${lives}`;
    }
    
    // ===== —Å–æ–±—ã—Ç–∏—è =====
    holdBtn.addEventListener('mousedown', onPress);
    holdBtn.addEventListener('mouseup', onRelease);
    holdBtn.addEventListener('mouseleave', onRelease);
    holdBtn.addEventListener('touchstart', onPress, { passive: false });
    holdBtn.addEventListener('touchend', onRelease);
    holdBtn.addEventListener('touchcancel', onRelease);
    holdBtn.addEventListener('contextmenu', e => e.preventDefault());
    
    document.addEventListener('mouseup', (e) => {
        if (holding && gameActive && !victory && lives > 0 && !gameEnded) onRelease(e);
    });
    document.addEventListener('touchend', (e) => {
        if (holding && gameActive && !victory && lives > 0 && !gameEnded && !holdBtn.contains(e.target)) onRelease(e);
    });
    
    // –∑–∞–∫—Ä—ã—Ç—å –æ–±—É—á–µ–Ω–∏–µ
    closeTutorialBtn.addEventListener('click', () => {
        tutorialModal.classList.add('hidden');
    });
    
    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    holdMs = 0;
    lives = MAX_LIVES;
    gameActive = true;
    victory = false;
    holding = false;
    gameEnded = false;
    updateLivesUI();
    refreshVisuals();
    statusMsg.innerText = `–¶–µ–ª—å: ${TARGET_MINUTES} –º–∏–Ω`;
    holdBtn.disabled = false;
    pancakeSpan.textContent = '0';
    
    scarecrow.onerror = function() {
        console.warn('–∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å');
        this.style.display = 'none';
        const parent = this.parentNode;
        const emoji = document.createElement('div');
        emoji.style.fontSize = '5rem';
        emoji.style.textAlign = 'center';
        emoji.style.lineHeight = '140px';
        emoji.textContent = 'üåæüëπüåæ';
        parent.insertBefore(emoji, this);
    };
})();
</script>
</body>
</html>
