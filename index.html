<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ú–∞—Å–ª–µ–Ω–∏—Ü–∞: –ò–≥—Ä–∞ –Ω–∞ –ü–∞–º—è—Ç—å</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#ffb347,#ffcc33,#ff6f61);
    display:flex;
    flex-direction:column;
    align-items:center;
    color:#5a2d0c;
    text-align:center;
    overflow-x:hidden;
}

h1{ margin:12px 0 4px 0; }

#timer{ font-size:20px; font-weight:bold; }
#round{ font-size:17px; margin-bottom:5px; }
#moves{ font-size:17px; color:#8b4513; margin:4px 0; }

/* ===== –®–ö–ê–õ–ê ===== */
.score-container{
    width:85%;
    max-width:320px;
    height:22px;
    background:#ffd8a8;
    border-radius:20px;
    overflow:hidden;
    position:relative;
    margin:8px 0;
}

.score-bar{
    height:100%;
    width:0%;
    background:#e67e22;
    transition:width 0.3s;
}

.score-text{
    position:absolute;
    width:100%;
    top:0;
    left:0;
    font-size:14px;
    line-height:22px;
    font-weight:bold;
}

/* ===== –ò–ì–†–ê ===== */
.game{
    display:grid;
    gap:8px;
    justify-content:center;
    margin:10px;
    width:95vw;
    max-width:500px;
}

.round1 .card{ width:90px; height:90px; }
.round2 .card{ width:80px; height:80px; }
.round3 .card{ width:65px; height:65px; }

.card{
    perspective:600px;
    position:relative;
}

.inner{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transition:transform 0.4s;
}

.card.flipped .inner{
    transform:rotateY(180deg);
}

.front, .back{
    position:absolute;
    width:100%;
    height:100%;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    backface-visibility:hidden;
    transition:background 0.3s, box-shadow 0.3s;
}

.front{ background:#e67e22; }
.back{
    background:#fff3cd;
    transform:rotateY(180deg);
}

.correct .back{
    background:#b8f5b1;
    box-shadow:0 0 15px #4caf50;
}

.wrong .back{
    background:#ffb3b3;
    box-shadow:0 0 15px #ff0000;
}

@keyframes shake{
    0%,100%{ transform:rotateY(180deg) translateX(0); }
    25%{ transform:rotateY(180deg) translateX(-5px); }
    75%{ transform:rotateY(180deg) translateX(5px); }
}

.wrong .inner{
    animation:shake 0.4s;
}

.floating{
    position:absolute;
    font-weight:bold;
    pointer-events:none;
    animation:floatUp 1s ease-out forwards;
}

@keyframes floatUp{
    0% {opacity:1; transform:translateY(0);}
    100% {opacity:0; transform:translateY(-40px);}
}

button{
    padding:8px 18px;
    border:none;
    border-radius:20px;
    font-size:14px;
    cursor:pointer;
    background:#ff6f61;
    color:white;
    margin:15px 0;
}

#results, #tutorial {
    margin: 20px;
    font-size: 16px;
    background: #fff3cd;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 600px;
    text-align: left;
}

#startButton {
    margin-top: 10px;
}
</style>
</head>
<body>

<h1>–ú–∞—Å–ª–µ–Ω–∏—Ü–∞: –ò–≥—Ä–∞ –Ω–∞ –ü–∞–º—è—Ç—å</h1>
<div id="timer">01:30</div>
<div id="round">–†–∞—É–Ω–¥ 1</div>
<div id="moves">–•–æ–¥—ã: 10</div>

<div class="score-container">
    <div class="score-bar" id="scoreBar"></div>
    <div class="score-text" id="scoreText">0 / 100</div>
</div>

<div class="game round1" id="game" style="display:none;"></div>
<div id="results" style="display:none;"></div>
<div id="tutorial">
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! ü•û</h2>
    <p>–ù–∞–π–¥–∏ –ø–∞—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–º–æ–¥–∑–∏, –∫–ª–∏–∫–∞—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏.</p>
    <p>–£ —Ç–µ–±—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –≤—Ä–µ–º—è (1:30) –∏ —Ö–æ–¥—ã –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥.</p>
    <p>–ó–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è +5 –æ—á–∫–æ–≤, –∑–∞ –æ—à–∏–±–∫–∏ -2.</p>
    <p>–°–æ–±–µ—Ä–∏ –≤—Å–µ –ø–∞—Ä—ã –≤ 3 —Ä–∞—É–Ω–¥–∞—Ö, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å!</p>
    <p>–ú–µ–Ω—å—à–µ —Ö–æ–¥–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –±–æ–ª—å—à–µ –±–ª–∏–Ω—á–∏–∫–æ–≤ –≤ –∫–æ–Ω—Ü–µ.</p>
    <button id="startButton" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
</div>

<script>
const emojis = [
    "ü•û","ü™Ü","üî•","üåû","üå∑","üçÑ‚Äçüü´",
    "üçØ","üçì","üêª","üßà"
];

let round = 1;
let firstCard = null;
let lock = false;
let matches = 0;
let timer;
let timeLeft = 90;
let score = 0;
let movesLeft = 10;
let totalMoves = 0;

const maxMoves = [0, 10, 20, 30]; // —Ä–∞—É–Ω–¥—ã 1,2,3

function startGame(){
    document.getElementById("tutorial").style.display = "none";
    document.getElementById("game").style.display = "grid";

    round = 1;
    timeLeft = 90;
    score = 0;
    totalMoves = 0;
    updateScore();
    startTimer();
    startRound();
    document.getElementById("results").style.display = "none";
}

function startTimer(){
    clearInterval(timer);
    updateTimer();
    timer = setInterval(()=>{
        timeLeft--;
        updateTimer();
        if(timeLeft <= 0){
            clearInterval(timer);
            showTimeoutResults();
        }
    },1000);
}

function startRound(){
    const game = document.getElementById("game");
    game.className = "game round" + round;
    document.getElementById("round").textContent = "–†–∞—É–Ω–¥ " + round;
    movesLeft = maxMoves[round];
    updateMoves();

    matches = 0;
    firstCard = null;
    lock = false;

    let pairs = round === 1 ? 3 : round === 2 ? 6 : 10;

    let selected = emojis.slice(0, pairs);
    let cardsArray = [...selected, ...selected];
    cardsArray.sort(() => 0.5 - Math.random());

    game.innerHTML = "";

    let columns = round === 3 ? 5 : Math.ceil(Math.sqrt(cardsArray.length));
    game.style.gridTemplateColumns = `repeat(${columns}, auto)`;

    cardsArray.forEach(emoji=>{
        const card = document.createElement("div");
        card.classList.add("card");

        const inner = document.createElement("div");
        inner.classList.add("inner");

        const front = document.createElement("div");
        front.classList.add("front");

        const back = document.createElement("div");
        back.classList.add("back");
        back.textContent = emoji;

        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);

        card.dataset.emoji = emoji;
        card.addEventListener("click", flipCard);

        game.appendChild(card);
    });
}

function flipCard(){
    if(lock || this.classList.contains("flipped") || movesLeft <= 0) return;

    if(!firstCard){
        this.classList.add("flipped");
        firstCard = this;
        return;
    }

    movesLeft--;
    totalMoves++;
    updateMoves();

    this.classList.add("flipped");

    if(firstCard.dataset.emoji === this.dataset.emoji){
        matches++;
        this.classList.add("correct");
        firstCard.classList.add("correct");

        addScore(5, this);

        firstCard = null;

        if(matches === (round === 1 ? 3 : round === 2 ? 6 : 10)){
            if(round < 3){
                round++;
                setTimeout(startRound, 800);
            } else {
                clearInterval(timer);
                showResults();
            }
        }
    } else {
        lock = true;

        this.classList.add("wrong");
        firstCard.classList.add("wrong");

        addScore(-2, this);

        setTimeout(()=>{
            this.classList.remove("flipped","wrong");
            firstCard.classList.remove("flipped","wrong");
            firstCard = null;
            lock = false;

            if(movesLeft <= 0){
                clearInterval(timer);
                showMovesOutResults();
            }
        },800);
    }
}

function addScore(amount, element){
    score += amount;
    if(score < 0) score = 0;
    if(score > 100) score = 100;
    updateScore();

    const float = document.createElement("div");
    float.className = "floating";
    float.textContent = (amount > 0 ? "+" : "") + amount;
    float.style.color = amount > 0 ? "green" : "red";

    const rect = element.getBoundingClientRect();
    float.style.left = rect.left + rect.width/2 + "px";
    float.style.top = rect.top + "px";

    document.body.appendChild(float);
    setTimeout(()=> float.remove(),1000);
}

function updateScore(){
    document.getElementById("scoreBar").style.width = score + "%";
    document.getElementById("scoreText").textContent = score + " / 100";
}

function updateMoves(){
    document.getElementById("moves").textContent = "–•–æ–¥—ã: " + movesLeft;
}

function updateTimer(){
    let minutes = Math.floor(timeLeft/60);
    let seconds = timeLeft%60;
    document.getElementById("timer").textContent =
        minutes.toString().padStart(2,"0") + ":" +
        seconds.toString().padStart(2,"0");
}

function getTimePancakes(time) {
    if (time <= 10) return 10;
    if (time <= 30) return 9;
    if (time <= 50) return 6;
    if (time <= 70) return 7;
    if (time <= 80) return 4;
    if (time <= 90) return 2;
    return 0;
}

function getScorePancakes(score) {
    if (score <= 5) return 1;
    if (score <= 10) return 2;
    if (score <= 20) return 3;
    if (score <= 40) return 4;
    if (score <= 60) return 5;
    if (score <= 80) return 6;
    if (score <= 100) return 10;
    return 0;
}

function getMovesPancakes(moves) {
    if (moves <= 1) return 10;
    if (moves <= 10) return 9;
    if (moves <= 20) return 8;
    if (moves <= 40) return 6;
    if (moves <= 50) return 4;
    if (moves <= 60) return 3;
    return 0;
}

function showResults() {
    const elapsedTime = 90 - timeLeft;
    const timePancakes = getTimePancakes(elapsedTime);
    const scorePancakes = getScorePancakes(score);
    const movesPancakes = getMovesPancakes(totalMoves);
    const totalPancakes = timePancakes + scorePancakes + movesPancakes;

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = `
        <h2>üéâ –ò–≥—Ä–∞ –ø—Ä–æ–π–¥–µ–Ω–∞!</h2>
        <p>–í—Ä–µ–º—è: ${elapsedTime} —Å–µ–∫ (${timePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–ó–∞—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ —Ö–æ–¥—ã: ${totalMoves} (${movesPancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–û—á–∫–∏: ${score} (${scorePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–í—Å–µ–≥–æ –±–ª–∏–Ω—á–∏–∫–æ–≤: ${totalPancakes} ü•û</p>
        <p style="font-size: 12px; margin-top: 20px;">–ù–µ –∑–∞–±—É–¥—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≥—Ä—É–ø–ø—É</p>
    `;
    resultsDiv.style.display = "block";
    document.getElementById("game").style.display = "none";
    localStorage.setItem('resultsHTML', resultsDiv.innerHTML);
    localStorage.setItem('gameCompleted', 'true');
}

function showTimeoutResults() {
    const elapsedTime = 90 - timeLeft;
    const timePancakes = getTimePancakes(elapsedTime);
    const scorePancakes = getScorePancakes(score);
    const movesPancakes = getMovesPancakes(totalMoves);
    let totalPancakes = timePancakes + scorePancakes + movesPancakes;
    totalPancakes = Math.floor(totalPancakes * 0.65);

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = `
        <h2>‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ!</h2>
        <p>–í—Ä–µ–º—è: ${elapsedTime} —Å–µ–∫ (${timePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–ó–∞—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ —Ö–æ–¥—ã: ${totalMoves} (${movesPancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–û—á–∫–∏: ${score} (${scorePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–í—Å–µ–≥–æ –±–ª–∏–Ω—á–∏–∫–æ–≤: ${totalPancakes} ü•û</p>
        <p style="font-size: 12px; margin-top: 20px;">–ù–µ –∑–∞–±—É–¥—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≥—Ä—É–ø–ø—É</p>
    `;
    resultsDiv.style.display = "block";
    document.getElementById("game").style.display = "none";
    localStorage.setItem('resultsHTML', resultsDiv.innerHTML);
    localStorage.setItem('gameCompleted', 'true');
}

function showMovesOutResults() {
    const elapsedTime = 90 - timeLeft;
    const timePancakes = getTimePancakes(elapsedTime);
    const scorePancakes = getScorePancakes(score);
    const movesPancakes = getMovesPancakes(totalMoves);
    const totalPancakes = timePancakes + scorePancakes + movesPancakes;

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = `
        <h2>üö´ –•–æ–¥—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!</h2>
        <p>–í—Ä–µ–º—è: ${elapsedTime} —Å–µ–∫ (${timePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–ó–∞—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ —Ö–æ–¥—ã: ${totalMoves} (${movesPancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–û—á–∫–∏: ${score} (${scorePancakes} –±–ª–∏–Ω—á–∏–∫–æ–≤)</p>
        <p>–í—Å–µ–≥–æ –±–ª–∏–Ω—á–∏–∫–æ–≤: ${totalPancakes} ü•û</p>
        <p style="font-size: 12px; margin-top: 20px;">–ù–µ –∑–∞–±—É–¥—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≥—Ä—É–ø–ø—É</p>
    `;
    resultsDiv.style.display = "block";
    document.getElementById("game").style.display = "none";
    localStorage.setItem('resultsHTML', resultsDiv.innerHTML);
    localStorage.setItem('gameCompleted', 'true');
}

window.onload = function() {
    if (localStorage.getItem('gameCompleted')) {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = localStorage.getItem('resultsHTML');
        resultsDiv.style.display = "block";
        document.getElementById("tutorial").style.display = "none";
        document.getElementById("game").style.display = "none";
    } else {
        document.getElementById("tutorial").style.display = "block";
        document.getElementById("game").style.display = "none";
        document.getElementById("results").style.display = "none";
    }
};
</script>

</body>
</html>
